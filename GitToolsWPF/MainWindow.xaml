<Window x:Class="GitToolsWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:GitToolsWPF.ViewModels"
        Title="{Binding WindowTitle}" 
        Height="750" Width="1300"
        MinHeight="600" MinWidth="1000"
        WindowStartupLocation="CenterScreen"
        Background="{DynamicResource ContentBackground}"
        Foreground="{DynamicResource TextBrush}"
        Icon="/ico.ico">
    
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="1*"/>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="3*"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧导航栏 -->
        <Border Grid.Column="0" 
                Background="{DynamicResource NavBackground}" 
                BorderBrush="{DynamicResource BorderBrush}" 
                BorderThickness="0,0,1,0">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="15">
                    <TextBlock Text="Git Tools" 
                               FontSize="22" 
                               FontWeight="Bold" 
                               Margin="0,15,0,15" 
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <!-- 当前状态显示 -->
                    <Border Background="{DynamicResource NavBackground}"
                            BorderBrush="{DynamicResource BorderBrush}"
                            BorderThickness="1"
                            Padding="10"
                            CornerRadius="5"
                            Margin="0,0,0,20">
                        <StackPanel>
                            <TextBlock Text="📍 当前状态" 
                                       FontSize="11" 
                                       FontWeight="SemiBold" 
                                       Opacity="0.6"
                                       Foreground="{DynamicResource TextBrush}"
                                       Margin="0,0,0,8"/>
                            
                            <TextBlock Text="{Binding CurrentBranchName}" 
                                       FontSize="12"
                                       FontWeight="SemiBold"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,8">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="#007BFF"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsDetachedHead}" Value="True">
                                                <Setter Property="Foreground" Value="#FFC107"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            
                            <!-- 游离 HEAD 警告 -->
                            <Border Background="#FFC107" 
                                    Padding="6,4" 
                                    CornerRadius="3"
                                    Visibility="{Binding IsDetachedHead, Converter={StaticResource BoolToVisibilityConverter}}">
                                <TextBlock Text="⚠️ 游离状态" 
                                           FontSize="10"
                                           FontWeight="Bold"
                                           Foreground="White"/>
                            </Border>
                            
                            <!-- 刷新按钮 -->
                            <Button Content="🔄 刷新状态"
                                    Command="{Binding CheckCurrentStatusCommand}"
                                    FontSize="10"
                                    Padding="6,4"
                                    Margin="0,8,0,0"
                                    Background="Transparent"
                                    Foreground="{DynamicResource TextBrush}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    Cursor="Hand"
                                    HorizontalAlignment="Stretch">
                                <Button.Style>
                                    <Style TargetType="Button">
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="Button">
                                                    <Border Background="{TemplateBinding Background}"
                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                            CornerRadius="3"
                                                            Padding="{TemplateBinding Padding}">
                                                        <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="{DynamicResource HoverBrush}"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </StackPanel>
                    </Border>
                    
                    <TextBlock Text="仓库操作" 
                               FontSize="11" 
                               FontWeight="SemiBold" 
                               Margin="0,0,0,8" 
                               Opacity="0.6"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <Button Content="📊 仓库状态（本地）" Click="NavButton_Click" Tag="History" Style="{DynamicResource NavButtonStyle}"/>
                    <Button Content="🔍 仓库查看（远程）" Click="NavButton_Click" Tag="Version" Style="{DynamicResource NavButtonStyle}"/>
                    <Button Content="⬆️ 初始推送" Click="NavButton_Click" Tag="Push" Style="{DynamicResource NavButtonStyle}"/>
                    <Button Content="🔄 更新推送" Click="NavButton_Click" Tag="Update" Style="{DynamicResource NavButtonStyle}"/>
                    <Button Content="🚀 版本发布" Click="NavButton_Click" Tag="Release" Style="{DynamicResource NavButtonStyle}"/>
                    <Button Content="📦 项目克隆" Click="NavButton_Click" Tag="Clone" Style="{DynamicResource NavButtonStyle}"/>
                    <Button Content="🔄 初始化历史" Click="NavButton_Click" Tag="InitHistory" Style="{DynamicResource NavButtonStyle}"/>
                    <Button Content="🧹 仓库清理" Click="NavButton_Click" Tag="Clean" Style="{DynamicResource NavButtonStyle}"/>
                    
                    <Separator Margin="0,20,0,15" Background="{DynamicResource BorderBrush}"/>
                    
                    <TextBlock Text="系统设置" 
                               FontSize="11" 
                               FontWeight="SemiBold" 
                               Margin="0,0,0,8" 
                               Opacity="0.6"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <Button Content="⚙️ 设置" Click="NavButton_Click" Tag="Settings" Style="{DynamicResource NavButtonStyle}"/>
                    
                    <Separator Margin="0,20,0,15" Background="{DynamicResource BorderBrush}"/>
                    
                    <TextBlock Text="主题" 
                               FontSize="11" 
                               FontWeight="SemiBold" 
                               Margin="0,0,0,8" 
                               Opacity="0.6"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <Button Content="☀️ 浅色" Command="{Binding ChangeThemeCommand}" CommandParameter="Light" Style="{DynamicResource NavButtonStyle}"/>
                    <Button Content="🌙 深色" Command="{Binding ChangeThemeCommand}" CommandParameter="Dark" Style="{DynamicResource NavButtonStyle}"/>
                    <Button Content="💻 跟随系统" Command="{Binding ChangeThemeCommand}" CommandParameter="System" Style="{DynamicResource NavButtonStyle}"/>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- 主内容区 -->
        <ScrollViewer x:Name="ContentScrollViewer"
                      Grid.Column="1" 
                      VerticalScrollBarVisibility="Auto" 
                      Background="{DynamicResource ContentBackground}">
            <Grid Margin="30" Background="{DynamicResource ContentBackground}">
                
                <!-- 仓库状态页面 -->
                <StackPanel x:Name="HistoryPage" Visibility="Visible">
                    <TextBlock Text="📊 仓库状态（本地）" FontSize="28" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource TextBrush}"/>
                    <TextBlock Text="查看本地仓库的当前状态、未提交更改、最近提交和分支信息" 
                               Margin="0,0,0,25" 
                               Opacity="0.7"
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <StackPanel Orientation="Vertical" Margin="0,0,0,15">
                        <Button Content="📝 本地未提交更改" Command="{Binding ViewLocalChangesCommand}" Width="180" HorizontalAlignment="Left" Margin="0,0,0,10" Style="{DynamicResource ActionButtonStyle}"/>
                        <Button Content="📜 本地提交历史" Command="{Binding ViewLocalCommitsCommand}" Width="180" HorizontalAlignment="Left" Margin="0,0,0,10" Style="{DynamicResource ActionButtonStyle}"/>
                        <Button Content="🌿 本地分支信息" Command="{Binding ViewLocalBranchesCommand}" Width="180" HorizontalAlignment="Left" Style="{DynamicResource ActionButtonStyle}"/>
                    </StackPanel>
                    
                    <Separator Margin="0,10,0,20" Background="{DynamicResource BorderBrush}"/>
                    
                    <TextBlock Text="或查看完整信息：" Margin="0,0,0,10" FontWeight="SemiBold" Foreground="{DynamicResource TextBrush}"/>
                    <Button Content="📋 查看全部本地信息" 
                            Command="{Binding ViewHistoryCommand}" 
                            Width="180" 
                            HorizontalAlignment="Left" 
                            Style="{DynamicResource ActionButtonStyle}"/>
                </StackPanel>

                <!-- 初始推送页面 -->
                <StackPanel x:Name="PushPage" Visibility="Collapsed">
                    <TextBlock Text="⬆️ 初始推送" FontSize="28" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource TextBrush}"/>
                    <TextBlock Text="初始化 Git 仓库并推送到 GitHub" 
                               Margin="0,0,0,25" 
                               Opacity="0.7"
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <!-- 常规推送 -->
                    <Border BorderBrush="{DynamicResource BorderBrush}" 
                            BorderThickness="2" 
                            Padding="20" 
                            Margin="0,0,0,15" 
                            Background="{DynamicResource NavBackground}"
                            CornerRadius="6">
                        <StackPanel>
                            <TextBlock Text="📤 常规推送（推荐）" 
                                       FontWeight="Bold" 
                                       FontSize="16" 
                                       Margin="0,0,0,12" 
                                       Foreground="{DynamicResource TextBrush}"/>
                            <TextBlock TextWrapping="Wrap" 
                                       Margin="0,0,0,15" 
                                       Opacity="0.8"
                                       LineHeight="22"
                                       Foreground="{DynamicResource TextBrush}">
                                正常推送到 GitHub。如果远程仓库已有内容，推送会失败，保护远程数据不被覆盖。
                                适合首次推送到空仓库。
                            </TextBlock>
                            <StackPanel Margin="0,0,0,15">
                                <TextBlock Text="✓ 安全，不会覆盖远程内容" Margin="0,0,0,5" Foreground="#28A745"/>
                                <TextBlock Text="✓ 适合首次推送到空仓库" Margin="0,0,0,5" Foreground="#28A745"/>
                                <TextBlock Text="✓ 如果远程有内容会提示错误" Margin="0,0,0,0" Foreground="#28A745"/>
                            </StackPanel>
                            <Button Content="常规推送" 
                                    Command="{Binding PushCommand}" 
                                    Width="140" 
                                    HorizontalAlignment="Left" 
                                    Style="{DynamicResource ActionButtonStyle}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- 强制推送 -->
                    <Border BorderBrush="#DC3545" 
                            BorderThickness="2" 
                            Padding="20" 
                            Margin="0,0,0,20" 
                            Background="{DynamicResource NavBackground}"
                            CornerRadius="6">
                        <StackPanel>
                            <TextBlock Text="⚠️ 强制推送" 
                                       FontWeight="Bold" 
                                       FontSize="16" 
                                       Margin="0,0,0,12" 
                                       Foreground="#DC3545"/>
                            <TextBlock TextWrapping="Wrap" 
                                       Margin="0,0,0,15" 
                                       Opacity="0.8"
                                       LineHeight="22"
                                       Foreground="{DynamicResource TextBrush}">
                                强制推送到 GitHub，会覆盖远程仓库的所有内容和历史记录。
                                仅在确定要覆盖远程仓库时使用。
                            </TextBlock>
                            <StackPanel Margin="0,0,0,15">
                                <TextBlock Text="✗ 会覆盖远程仓库所有内容" Margin="0,0,0,5" Foreground="#DC3545"/>
                                <TextBlock Text="✗ 会覆盖远程仓库所有历史" Margin="0,0,0,5" Foreground="#DC3545"/>
                                <TextBlock Text="⚠️ 此操作不可逆！" Margin="0,5,0,0" Foreground="#DC3545" FontWeight="Bold"/>
                            </StackPanel>
                            <Button Content="强制推送" 
                                    Command="{Binding ForcePushCommand}" 
                                    Width="140" 
                                    HorizontalAlignment="Left" 
                                    Background="#DC3545"
                                    Foreground="White"
                                    Style="{DynamicResource ActionButtonStyle}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- 更新推送页面 -->
                <StackPanel x:Name="UpdatePage" Visibility="Collapsed">
                    <TextBlock Text="🔄 更新推送" FontSize="28" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource TextBrush}"/>
                    <TextBlock Text="提交本地更改并推送到 GitHub" 
                               Margin="0,0,0,25" 
                               Opacity="0.7"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <TextBlock Text="提交信息：" Margin="0,0,0,8" FontWeight="SemiBold" Foreground="{DynamicResource TextBrush}"/>
                    <TextBox Text="{Binding CommitMessage}" 
                             Width="450" 
                             HorizontalAlignment="Left" 
                             Margin="0,0,0,20" 
                             Style="{DynamicResource TextBoxStyle}"/>
                    
                    <Button Content="提交并推送" 
                            Command="{Binding UpdateCommand}" 
                            Width="140" 
                            HorizontalAlignment="Left" 
                            Style="{DynamicResource ActionButtonStyle}"/>
                </StackPanel>

                <!-- 版本发布页面 -->
                <StackPanel x:Name="ReleasePage" Visibility="Collapsed">
                    <TextBlock Text="🚀 版本发布" FontSize="28" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource TextBrush}"/>
                    <TextBlock Text="创建版本标签并发布到 GitHub" 
                               Margin="0,0,0,25" 
                               Opacity="0.7"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <!-- 当前版本信息 -->
                    <Border Background="{DynamicResource NavBackground}" 
                            BorderBrush="{DynamicResource BorderBrush}" 
                            BorderThickness="1" 
                            Padding="15" 
                            Margin="0,0,0,20"
                            CornerRadius="6">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="当前版本：" FontWeight="SemiBold" Foreground="{DynamicResource TextBrush}"/>
                            <TextBlock Text="{Binding CurrentVersion}" 
                                       FontWeight="Bold" 
                                       FontSize="16" 
                                       Margin="10,0,0,0"
                                       Foreground="#007BFF"/>
                            <Button Content="🔄 刷新" 
                                    Command="{Binding LoadVersionHistoryCommand}" 
                                    Margin="20,0,0,0"
                                    Padding="10,5"
                                    FontSize="12"
                                    Style="{DynamicResource ActionButtonStyle}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- 新版本发布 -->
                    <TextBlock Text="发布新版本" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15" Foreground="{DynamicResource TextBrush}"/>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <StackPanel Grid.Column="0">
                            <TextBlock Text="版本号（如 v1.0.0）：" Margin="0,0,0,8" FontWeight="SemiBold" Foreground="{DynamicResource TextBrush}"/>
                            <TextBox Text="{Binding VersionNumber}" 
                                     Width="350" 
                                     HorizontalAlignment="Left" 
                                     Margin="0,0,0,15" 
                                     Style="{DynamicResource TextBoxStyle}"/>
                        </StackPanel>
                        
                        <Button Grid.Column="1" 
                                Content="自动递增" 
                                Command="{Binding AutoIncrementVersionCommand}" 
                                VerticalAlignment="Bottom"
                                Margin="10,0,0,15"
                                Padding="15,10"
                                Style="{DynamicResource ActionButtonStyle}"/>
                    </Grid>
                    
                    <TextBlock Text="版本说明：" Margin="0,0,0,8" FontWeight="SemiBold" Foreground="{DynamicResource TextBrush}"/>
                    <TextBox Text="{Binding VersionNote}" 
                             Width="450" 
                             HorizontalAlignment="Left" 
                             Margin="0,0,0,20" 
                             Style="{DynamicResource TextBoxStyle}"/>
                    
                    <Button Content="发布版本" 
                            Command="{Binding ReleaseCommand}" 
                            Width="140" 
                            HorizontalAlignment="Left" 
                            Margin="0,0,0,30"
                            Style="{DynamicResource ActionButtonStyle}"/>
                    
                    <!-- 版本历史 -->
                    <TextBlock Text="版本历史" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,15" Foreground="{DynamicResource TextBrush}"/>
                    
                    <Border Background="{DynamicResource NavBackground}" 
                            BorderBrush="{DynamicResource BorderBrush}" 
                            BorderThickness="1" 
                            Padding="10" 
                            CornerRadius="6"
                            Height="250">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <ListBox Grid.Row="0"
                                     ItemsSource="{Binding VersionHistory}" 
                                     SelectedItem="{Binding SelectedVersion}"
                                     Background="Transparent"
                                     BorderThickness="0"
                                     ScrollViewer.VerticalScrollBarVisibility="Auto">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="10,8" 
                                                Margin="0,2" 
                                                Background="{DynamicResource ContentBackground}"
                                                BorderBrush="{DynamicResource BorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="4">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <TextBlock Grid.Column="0" 
                                                           Text="{Binding TagName}" 
                                                           FontWeight="Bold" 
                                                           FontSize="14"
                                                           Foreground="#007BFF"
                                                           VerticalAlignment="Center"
                                                           Width="100"/>
                                                
                                                <StackPanel Grid.Column="1" Margin="15,0">
                                                    <TextBlock Text="{Binding Message}" 
                                                               FontSize="13"
                                                               Foreground="{DynamicResource TextBrush}"
                                                               TextTrimming="CharacterEllipsis"/>
                                                    <TextBlock Text="{Binding CommitHash}" 
                                                               FontSize="11"
                                                               Opacity="0.6"
                                                               Foreground="{DynamicResource TextBrush}"/>
                                                </StackPanel>
                                                
                                                <TextBlock Grid.Column="2" 
                                                           Text="{Binding Date}" 
                                                           FontSize="12"
                                                           Opacity="0.7"
                                                           Foreground="{DynamicResource TextBrush}"
                                                           VerticalAlignment="Center"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                            
                            <Button Grid.Row="1" 
                                    Content="删除选中版本" 
                                    Command="{Binding DeleteVersionCommand}" 
                                    Margin="0,10,0,0"
                                    Padding="12,8"
                                    Background="#DC3545"
                                    Foreground="White"
                                    HorizontalAlignment="Left"
                                    Style="{DynamicResource ActionButtonStyle}"/>
                        </Grid>
                    </Border>
                </StackPanel>

                <!-- 仓库查看页面 -->
                <StackPanel x:Name="VersionPage" Visibility="Collapsed">
                    <TextBlock Text="🔍 仓库查看（远程）" FontSize="28" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource TextBrush}"/>
                    <TextBlock Text="查看 GitHub 远程仓库的提交历史、同步状态、分支和标签信息" 
                               Margin="0,0,0,25" 
                               Opacity="0.7"
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <!-- 主要功能按钮 -->
                    <Border BorderBrush="{DynamicResource BorderBrush}" 
                            BorderThickness="2" 
                            Padding="25" 
                            Margin="0,0,0,20" 
                            Background="{DynamicResource NavBackground}"
                            CornerRadius="8">
                        <StackPanel>
                            <TextBlock Text="📊 图形化提交历史" 
                                       FontWeight="Bold" 
                                       FontSize="18" 
                                       Margin="0,0,0,15" 
                                       Foreground="{DynamicResource TextBrush}"/>
                            <TextBlock TextWrapping="Wrap" 
                                       Margin="0,0,0,20" 
                                       Opacity="0.8"
                                       LineHeight="22"
                                       Foreground="{DynamicResource TextBrush}">
                                在独立窗口中查看提交历史，支持：
                            </TextBlock>
                            <StackPanel Margin="0,0,0,20">
                                <TextBlock Text="✓ 图形化分支展示，清晰看出主线与分支关系" Margin="0,0,0,8" Foreground="#28A745" FontSize="13"/>
                                <TextBlock Text="✓ 彩色标签区分本地分支、远程分支和HEAD位置" Margin="0,0,0,8" Foreground="#28A745" FontSize="13"/>
                                <TextBlock Text="✓ 分支筛选功能，可单独查看本地或远程分支" Margin="0,0,0,8" Foreground="#28A745" FontSize="13"/>
                                <TextBlock Text="✓ 点击任意提交即可切换到该版本查看代码" Margin="0,0,0,0" Foreground="#28A745" FontSize="13"/>
                            </StackPanel>
                            <Button Content="📜 打开提交历史窗口" 
                                    Command="{Binding ViewCommitHistoryCommand}" 
                                    Width="220" 
                                    HorizontalAlignment="Left"
                                    Padding="20,12"
                                    FontSize="15"
                                    FontWeight="SemiBold"
                                    Background="#007BFF"
                                    Foreground="White"
                                    Style="{DynamicResource ActionButtonStyle}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- 其他功能 -->
                    <TextBlock Text="其他查看功能：" 
                               FontSize="16" 
                               FontWeight="SemiBold" 
                               Margin="0,0,0,15" 
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <StackPanel Orientation="Vertical" Margin="0,0,0,20">
                        <Button Content="🔄 同步状态" Command="{Binding ViewSyncStatusCommand}" Width="160" HorizontalAlignment="Left" Margin="0,0,0,10" Style="{DynamicResource ActionButtonStyle}"/>
                        <Button Content="🌿 远程分支信息" Command="{Binding ViewBranchesCommand}" Width="160" HorizontalAlignment="Left" Margin="0,0,0,10" Style="{DynamicResource ActionButtonStyle}"/>
                        <Button Content="🏷️ 远程标签信息" Command="{Binding ViewTagsCommand}" Width="160" HorizontalAlignment="Left" Style="{DynamicResource ActionButtonStyle}"/>
                    </StackPanel>
                    
                    <Separator Margin="0,0,0,20" Background="{DynamicResource BorderBrush}"/>
                    
                    <TextBlock Text="或查看完整信息：" Margin="0,0,0,10" FontWeight="SemiBold" Foreground="{DynamicResource TextBrush}"/>
                    <Button Content="📋 查看全部远程信息" Command="{Binding ViewVersionCommand}" Width="180" HorizontalAlignment="Left" Style="{DynamicResource ActionButtonStyle}"/>
                </StackPanel>

                <!-- 项目克隆页面 -->
                <StackPanel x:Name="ClonePage" Visibility="Collapsed">
                    <TextBlock Text="📦 项目克隆" FontSize="28" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource TextBrush}"/>
                    <TextBlock Text="从 GitHub 克隆项目到本地新位置，用于在不同地方维护项目" 
                               Margin="0,0,0,20" 
                               Opacity="0.7"
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <!-- 克隆按钮 - 置顶 -->
                    <Button Content="🚀 从 GitHub 克隆项目" 
                            Command="{Binding CloneProjectCommand}" 
                            Width="200" 
                            HorizontalAlignment="Left" 
                            Padding="20,14"
                            FontSize="15"
                            FontWeight="SemiBold"
                            Margin="0,0,0,30"
                            Background="#007BFF"
                            Foreground="White"
                            Style="{DynamicResource ActionButtonStyle}"/>
                    
                    <!-- 克隆说明 -->
                    <Border BorderBrush="{DynamicResource BorderBrush}" 
                            BorderThickness="2" 
                            Padding="20" 
                            Margin="0,0,0,20" 
                            Background="{DynamicResource NavBackground}"
                            CornerRadius="6">
                        <StackPanel>
                            <TextBlock Text="📋 功能说明" 
                                       FontWeight="Bold" 
                                       FontSize="16" 
                                       Margin="0,0,0,12" 
                                       Foreground="{DynamicResource TextBrush}"/>
                            <TextBlock TextWrapping="Wrap" 
                                       Margin="0,0,0,15" 
                                       Opacity="0.8"
                                       LineHeight="22"
                                       Foreground="{DynamicResource TextBrush}">
                                此功能将从 GitHub 仓库克隆完整项目到本地新位置，包括所有文件和 Git 历史记录。
                                适用于需要在多个位置维护同一项目的场景。
                            </TextBlock>
                            <StackPanel Margin="0,0,0,0">
                                <TextBlock Text="✓ 从 GitHub 下载完整项目" Margin="0,0,0,5" Foreground="#28A745"/>
                                <TextBlock Text="✓ 包含所有文件和 Git 历史" Margin="0,0,0,5" Foreground="#28A745"/>
                                <TextBlock Text="✓ 可在新位置独立维护" Margin="0,0,0,5" Foreground="#28A745"/>
                                <TextBlock Text="✓ 目标文件夹必须为空" Margin="0,0,0,0" Foreground="#FFC107"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                    
                    <!-- 路径信息 -->
                    <Border Background="{DynamicResource NavBackground}" 
                            BorderBrush="{DynamicResource BorderBrush}" 
                            BorderThickness="1" 
                            Padding="15" 
                            Margin="0,0,0,20"
                            CornerRadius="6">
                        <StackPanel>
                            <TextBlock Text="📂 克隆配置" 
                                       FontWeight="SemiBold" 
                                       Margin="0,0,0,12" 
                                       Foreground="{DynamicResource TextBrush}"/>
                            
                            <TextBlock Text="GitHub 仓库地址：" 
                                       FontSize="12" 
                                       Opacity="0.7" 
                                       Margin="0,0,0,5"
                                       Foreground="{DynamicResource TextBrush}"/>
                            <Border Background="{DynamicResource ContentBackground}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    Padding="10"
                                    Margin="0,0,0,15"
                                    CornerRadius="4">
                                <TextBlock FontFamily="Consolas" 
                                           FontSize="12"
                                           TextWrapping="Wrap"
                                           Foreground="{DynamicResource TextBrush}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="{Binding Settings.RepoUrl}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Settings.RepoUrl}" Value="">
                                                    <Setter Property="Text" Value="（未设置，请前往设置页面配置）"/>
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                    <Setter Property="FontStyle" Value="Italic"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Border>
                            
                            <TextBlock Text="克隆到本地文件夹：" 
                                       FontSize="12" 
                                       Opacity="0.7" 
                                       Margin="0,0,0,5"
                                       Foreground="{DynamicResource TextBrush}"/>
                            <Border Background="{DynamicResource ContentBackground}"
                                    BorderBrush="{DynamicResource BorderBrush}"
                                    BorderThickness="1"
                                    Padding="10"
                                    Margin="0,0,0,15"
                                    CornerRadius="4">
                                <TextBlock FontFamily="Consolas" 
                                           FontSize="12"
                                           TextWrapping="Wrap"
                                           Foreground="{DynamicResource TextBrush}">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="{Binding Settings.LocalFolder}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Settings.LocalFolder}" Value="">
                                                    <Setter Property="Text" Value="（未设置，请前往设置页面配置）"/>
                                                    <Setter Property="Opacity" Value="0.5"/>
                                                    <Setter Property="FontStyle" Value="Italic"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </Border>
                            
                            <Button Content="前往设置" 
                                    Click="NavButton_Click" 
                                    Tag="Settings"
                                    Width="120" 
                                    HorizontalAlignment="Left"
                                    Padding="12,8"
                                    Margin="0,5,0,0"
                                    FontSize="12"
                                    Style="{DynamicResource ActionButtonStyle}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- 注意事项 -->
                    <Border Background="#FFF3CD" 
                            BorderBrush="#FFC107" 
                            BorderThickness="1" 
                            Padding="15" 
                            Margin="0,0,0,0"
                            CornerRadius="4">
                        <StackPanel>
                            <TextBlock Text="⚠️ 注意事项" 
                                       FontWeight="Bold" 
                                       Foreground="#856404" 
                                       Margin="0,0,0,8"/>
                            <TextBlock TextWrapping="Wrap" 
                                       Foreground="#856404" 
                                       LineHeight="20">
                                • 请确保目标文件夹为空或不存在<LineBreak/>
                                • 如果目标文件夹非空，系统会提示您重新选择<LineBreak/>
                                • 克隆过程需要网络连接，可能需要几分钟<LineBreak/>
                                • 克隆过程中请勿关闭程序
                            </TextBlock>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- 初始化历史页面 -->
                <StackPanel x:Name="InitHistoryPage" Visibility="Collapsed">
                    <TextBlock Text="🔄 初始化历史" FontSize="28" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource TextBrush}"/>
                    <TextBlock Text="删除本地 .git 文件夹并重新初始化，开始全新的 Git 历史" 
                               Margin="0,0,0,25" 
                               Opacity="0.7"
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <!-- 功能说明 -->
                    <Border BorderBrush="#FFC107" 
                            BorderThickness="2" 
                            Padding="25" 
                            Margin="0,0,0,20" 
                            Background="{DynamicResource NavBackground}"
                            CornerRadius="8">
                        <StackPanel>
                            <TextBlock Text="📋 功能说明" 
                                       FontWeight="Bold" 
                                       FontSize="18" 
                                       Margin="0,0,0,15" 
                                       Foreground="{DynamicResource TextBrush}"/>
                            
                            <TextBlock Text="操作流程：" 
                                       FontWeight="SemiBold" 
                                       Margin="0,0,0,10" 
                                       Foreground="{DynamicResource TextBrush}"/>
                            <TextBlock TextWrapping="Wrap" 
                                       Margin="0,0,0,20" 
                                       Opacity="0.8"
                                       LineHeight="24"
                                       Foreground="{DynamicResource TextBrush}">
                                此操作将删除本地文件夹中的 .git 目录，然后重新执行 git init，
                                创建一个全新的、不包含任何历史记录的 Git 仓库。本地文件不受影响。
                            </TextBlock>
                            
                            <TextBlock Text="特点：" 
                                       FontWeight="SemiBold" 
                                       Margin="0,0,0,10" 
                                       Foreground="{DynamicResource TextBrush}"/>
                            <StackPanel Margin="0,0,0,20">
                                <TextBlock Text="✓ 本地文件完全不受影响" Margin="0,0,0,6" FontSize="14" Foreground="#28A745"/>
                                <TextBlock Text="✓ 创建全新的 Git 历史" Margin="0,0,0,6" FontSize="14" Foreground="#28A745"/>
                                <TextBlock Text="✓ 远程仓库不受影响" Margin="0,0,0,6" FontSize="14" Foreground="#28A745"/>
                                <TextBlock Text="✗ 删除本地所有提交历史" Margin="0,0,0,6" FontSize="14" Foreground="#DC3545"/>
                                <TextBlock Text="✗ 删除本地所有分支和标签" Margin="0,0,0,6" FontSize="14" Foreground="#DC3545"/>
                            </StackPanel>
                            
                            <Border Background="#FFF3CD" 
                                    BorderBrush="#FFC107" 
                                    BorderThickness="1" 
                                    Padding="15" 
                                    Margin="0,0,0,20"
                                    CornerRadius="4">
                                <StackPanel>
                                    <TextBlock Text="⚠️ 重要提示" 
                                               FontWeight="Bold" 
                                               Foreground="#856404" 
                                               Margin="0,0,0,8"/>
                                    <TextBlock TextWrapping="Wrap" 
                                               Foreground="#856404" 
                                               LineHeight="20">
                                        • 此操作不可逆，本地 Git 历史将永久丢失<LineBreak/>
                                        • 如果远程仓库有重要历史，可以通过克隆恢复<LineBreak/>
                                        • 操作后必须使用「初始推送」中的「强制推送」<LineBreak/>
                                        • ❌ 不要使用「更新推送」，会因历史不匹配而失败<LineBreak/>
                                        • 适用于想要重新开始项目历史的场景
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                            
                            <Button Content="初始化历史" 
                                    Command="{Binding InitHistoryCommand}" 
                                    Width="160" 
                                    HorizontalAlignment="Left" 
                                    Background="#FFC107"
                                    Foreground="#212529"
                                    Padding="25,14"
                                    FontSize="14"
                                    FontWeight="SemiBold"
                                    Style="{DynamicResource ActionButtonStyle}"/>
                        </StackPanel>
                    </Border>
                    
                    <!-- 使用场景 -->
                    <Border BorderBrush="{DynamicResource BorderBrush}" 
                            BorderThickness="1" 
                            Padding="20" 
                            Margin="0,0,0,0" 
                            Background="{DynamicResource NavBackground}"
                            CornerRadius="6">
                        <StackPanel>
                            <TextBlock Text="💡 适用场景" 
                                       FontWeight="Bold" 
                                       FontSize="16" 
                                       Margin="0,0,0,12" 
                                       Foreground="{DynamicResource TextBrush}"/>
                            <TextBlock TextWrapping="Wrap" 
                                       Opacity="0.8"
                                       LineHeight="22"
                                       Foreground="{DynamicResource TextBrush}">
                                • 想要清除本地所有提交历史，重新开始<LineBreak/>
                                • 项目历史过于混乱，想要整理<LineBreak/>
                                • 准备将新项目推送到已有仓库<LineBreak/>
                                • 本地 .git 文件夹损坏需要重建
                            </TextBlock>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- 仓库清理页面 -->
                <StackPanel x:Name="CleanPage" Visibility="Collapsed">
                    <TextBlock Text="🧹 清空 GitHub 仓库" FontSize="28" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource TextBrush}"/>
                    <TextBlock Text="清空 GitHub 仓库并删除所有历史记录，本地文件不受影响" 
                               Margin="0,0,0,25" 
                               Opacity="0.7"
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <!-- 清空说明 -->
                    <Border BorderBrush="#DC3545" 
                            BorderThickness="2" 
                            Padding="25" 
                            Margin="0,0,0,20" 
                            Background="{DynamicResource NavBackground}"
                            CornerRadius="8">
                        <StackPanel>
                            <TextBlock Text="⚠️ 清空 GitHub 仓库" 
                                       FontWeight="Bold" 
                                       FontSize="18" 
                                       Margin="0,0,0,15" 
                                       Foreground="#DC3545"/>
                            
                            <TextBlock Text="操作说明：" 
                                       FontWeight="SemiBold" 
                                       Margin="0,0,0,10" 
                                       Foreground="{DynamicResource TextBrush}"/>
                            <TextBlock TextWrapping="Wrap" 
                                       Margin="0,0,0,20" 
                                       Opacity="0.8"
                                       LineHeight="24"
                                       Foreground="{DynamicResource TextBrush}">
                                此操作将在临时文件夹创建一个新的空仓库，然后强制推送到 GitHub，
                                彻底清空 GitHub 上的所有内容和历史记录。本地文件完全不受影响。
                            </TextBlock>
                            
                            <TextBlock Text="特点：" 
                                       FontWeight="SemiBold" 
                                       Margin="0,0,0,10" 
                                       Foreground="{DynamicResource TextBrush}"/>
                            <StackPanel Margin="0,0,0,20">
                                <TextBlock Text="✓ 仅清空 GitHub 仓库" Margin="0,0,0,6" FontSize="14" Foreground="#28A745"/>
                                <TextBlock Text="✓ 本地文件完全不受影响" Margin="0,0,0,6" FontSize="14" Foreground="#28A745"/>
                                <TextBlock Text="✗ 删除 GitHub 所有内容" Margin="0,0,0,6" FontSize="14" Foreground="#DC3545"/>
                                <TextBlock Text="✗ 删除 GitHub 所有提交历史" Margin="0,0,0,6" FontSize="14" Foreground="#DC3545"/>
                                <TextBlock Text="✗ 删除 GitHub 所有分支和标签" Margin="0,0,0,6" FontSize="14" Foreground="#DC3545"/>
                            </StackPanel>
                            
                            <Border Background="#FFF3CD" 
                                    BorderBrush="#FFC107" 
                                    BorderThickness="1" 
                                    Padding="15" 
                                    Margin="0,0,0,20"
                                    CornerRadius="4">
                                <StackPanel>
                                    <TextBlock Text="⚠️ 重要提示" 
                                               FontWeight="Bold" 
                                               Foreground="#856404" 
                                               Margin="0,0,0,8"/>
                                    <TextBlock TextWrapping="Wrap" 
                                               Foreground="#856404" 
                                               LineHeight="20">
                                        • 此操作不可逆，GitHub 上的所有数据将永久丢失<LineBreak/>
                                        • 如需备份，请在操作前手动复制本地文件夹<LineBreak/>
                                        • 操作完成后，GitHub 仓库将变为空仓库
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                            
                            <Button Content="清空 GitHub 仓库" 
                                    Command="{Binding CleanGitHubCommand}" 
                                    Width="180" 
                                    HorizontalAlignment="Left" 
                                    Background="#DC3545"
                                    Foreground="White"
                                    Padding="25,14"
                                    FontSize="14"
                                    Style="{DynamicResource ActionButtonStyle}"/>
                        </StackPanel>
                    </Border>
                </StackPanel>

                <!-- 设置页面 -->
                <StackPanel x:Name="SettingsPage" Visibility="Collapsed">
                    <TextBlock Text="⚙️ 设置" FontSize="28" FontWeight="Bold" Margin="0,0,0,10" Foreground="{DynamicResource TextBrush}"/>
                    <TextBlock Text="配置 GitHub 连接信息和本地仓库路径" 
                               Margin="0,0,0,25" 
                               Opacity="0.7"
                               Foreground="{DynamicResource TextBrush}"/>
                    
                    <TextBlock Text="GitHub 用户名：" Margin="0,0,0,8" FontWeight="SemiBold" Foreground="{DynamicResource TextBrush}"/>
                    <TextBox Text="{Binding Settings.GitHubUser}" 
                             Width="350" 
                             HorizontalAlignment="Left" 
                             Margin="0,0,0,20" 
                             Style="{DynamicResource TextBoxStyle}"/>
                    
                    <TextBlock Text="GitHub Token：" Margin="0,0,0,8" FontWeight="SemiBold" Foreground="{DynamicResource TextBrush}"/>
                    <PasswordBox x:Name="TokenBox" 
                                 Width="350" 
                                 HorizontalAlignment="Left" 
                                 Margin="0,0,0,20" 
                                 Style="{DynamicResource PasswordBoxStyle}"/>
                    
                    <TextBlock Margin="0,0,0,8" FontWeight="SemiBold">
                        <Run Text="仓库地址（" Foreground="{DynamicResource TextBrush}"/>
                        <Run Text="点击此处打开" 
                             Foreground="#007BFF" 
                             TextDecorations="Underline" 
                             Cursor="Hand"
                             MouseEnter="RepoUrlLink_MouseEnter"
                             MouseLeave="RepoUrlLink_MouseLeave"
                             MouseLeftButtonDown="RepoUrlLink_Click"/>
                        <Run Text="）：" Foreground="{DynamicResource TextBrush}"/>
                    </TextBlock>
                    <TextBox Text="{Binding Settings.RepoUrl}" 
                             Width="350" 
                             HorizontalAlignment="Left" 
                             Margin="0,0,0,20" 
                             Style="{DynamicResource TextBoxStyle}"/>
                    
                    <TextBlock Text="本地文件夹路径（用于工作和克隆）：" Margin="0,0,0,8" FontWeight="SemiBold" Foreground="{DynamicResource TextBrush}"/>
                    <ComboBox x:Name="LocalFolderComboBox"
                              Text="{Binding Settings.LocalFolder, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                              ItemsSource="{Binding Settings.LocalFolderHistory}"
                              IsEditable="True"
                              Width="350" 
                              HorizontalAlignment="Left" 
                              Margin="0,0,0,10"
                              SelectionChanged="LocalFolderComboBox_SelectionChanged">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" 
                                           TextTrimming="CharacterEllipsis"
                                           ToolTip="{Binding}"/>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <Button Content="浏览..." 
                                Click="BrowseFolder_Click" 
                                Width="90" 
                                Style="{DynamicResource ActionButtonStyle}"/>
                        <Button Content="🔄 检测仓库地址" 
                                Click="DetectRepoUrl_Click" 
                                Width="130"
                                Margin="10,0,0,0"
                                Style="{DynamicResource ActionButtonStyle}"/>
                    </StackPanel>
                    
                    <Button Content="保存设置" 
                            Command="{Binding SaveSettingsCommand}" 
                            Width="120" 
                            HorizontalAlignment="Left"
                            Style="{DynamicResource ActionButtonStyle}"/>
                </StackPanel>
            </Grid>
        </ScrollViewer>

        <!-- 日志窗口 -->
        <Border Grid.Column="2" 
                Background="{DynamicResource LogBackground}" 
                BorderBrush="{DynamicResource BorderBrush}" 
                BorderThickness="1,0,0,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <Border Grid.Row="0" 
                        Background="{DynamicResource NavBackground}" 
                        BorderBrush="{DynamicResource BorderBrush}" 
                        BorderThickness="0,0,0,1"
                        Padding="15,12">
                    <TextBlock Text="📋 运行日志" 
                               FontWeight="SemiBold" 
                               FontSize="13"
                               Foreground="{DynamicResource TextBrush}"/>
                </Border>
                
                <ListBox Grid.Row="1" 
                         x:Name="LogListBox"
                         ItemsSource="{Binding LogMessages}" 
                         Background="{DynamicResource LogBackground}" 
                         Foreground="{DynamicResource LogTextBrush}" 
                         BorderThickness="0" 
                         FontFamily="Consolas" 
                         FontSize="11.5"
                         Padding="10"
                         SelectionMode="Extended"
                         KeyDown="LogListBox_KeyDown"
                         ScrollViewer.HorizontalScrollBarVisibility="Auto" 
                         ScrollViewer.VerticalScrollBarVisibility="Auto">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="2"/>
                            <Setter Property="Margin" Value="0"/>
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="Foreground" Value="{DynamicResource LogTextBrush}"/>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="#3390FF"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>
            </Grid>
        </Border>
        
        <!-- 加载遮罩 -->
        <Grid Grid.ColumnSpan="3" 
              Background="#80000000" 
              Visibility="{Binding IsExecuting, Converter={StaticResource BoolToVisibilityConverter}}">
            <Border Background="{DynamicResource ContentBackground}" 
                    Padding="30" 
                    CornerRadius="8"
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center">
                <StackPanel>
                    <TextBlock Text="⏳ 正在执行..." 
                               FontSize="16" 
                               FontWeight="SemiBold"
                               HorizontalAlignment="Center"
                               Foreground="{DynamicResource TextBrush}"/>
                </StackPanel>
            </Border>
        </Grid>
        
        <!-- 悬浮提示框 -->
        <Border x:Name="NotificationBorder"
                Grid.ColumnSpan="3"
                Background="#28A745"
                Padding="20,15"
                CornerRadius="6"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"
                Margin="0,20,0,0"
                Visibility="Collapsed">
            <Border.Effect>
                <DropShadowEffect Color="Black" Opacity="0.3" BlurRadius="10" ShadowDepth="2"/>
            </Border.Effect>
            <StackPanel Orientation="Horizontal">
                <TextBlock x:Name="NotificationIcon"
                           Text="✓"
                           FontSize="18"
                           FontWeight="Bold"
                           Foreground="White"
                           Margin="0,0,10,0"
                           VerticalAlignment="Center"/>
                <TextBlock x:Name="NotificationText"
                           Text="操作成功"
                           FontSize="14"
                           Foreground="White"
                           VerticalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
